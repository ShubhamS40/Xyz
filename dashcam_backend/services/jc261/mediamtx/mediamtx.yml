###############################################
# ✅ FIXED MediaMTX Configuration for JC261
###############################################
# Changes:
# 1. ✅ Correct RTMP port: 1935 (was 1935, good!)
# 2. ✅ Added path rules for channel-based streams
# 3. ✅ HLS configuration optimized for playback
# 4. ✅ Disabled unnecessary protocols
###############################################

logLevel: info
logDestinations: [stdout]
logFile: mediamtx.log

readTimeout: 30s
writeTimeout: 30s
writeQueueSize: 2048
udpMaxPayloadSize: 1472

###############################################
# Authentication
###############################################

authMethod: internal

authInternalUsers:
- user: any
  pass:
  ips: []
  permissions:
  - action: publish
  - action: read
  - action: playback

- user: any
  pass:
  ips: ['127.0.0.1', '::1']
  permissions:
  - action: api
  - action: metrics
  - action: pprof

###############################################
# ✅ RTMP (PRIMARY INPUT FROM DEVICE)
###############################################

rtmp: yes
rtmpAddress: :1935  # ✅ CORRECT PORT
rtmpEncryption: "no"

###############################################
# ✅ HLS (PRIMARY OUTPUT FOR PLAYBACK)
###############################################

hls: yes
hlsAddress: :8888
hlsEncryption: no
hlsAllowOrigin: '*'

# ✅ PLAYBACK OPTIMIZATIONS
hlsAlwaysRemux: yes
hlsVariant: mpegts     # iOS compatible

hlsSegmentCount: 7
hlsSegmentDuration: 4s # Faster startup for playback
hlsPartDuration: 1s

hlsSegmentMaxSize: 50M
hlsDirectory: ''
hlsMuxerCloseAfter: 180s  # Keep alive longer for playback

###############################################
# WebRTC (Optional - for browser playback)
###############################################

webrtc: yes
webrtcAddress: :8889
webrtcEncryption: no
webrtcAllowOrigin: '*'
webrtcLocalUDPAddress: :8189

###############################################
# ✅ PATH CONFIGURATION
###############################################

pathDefaults:
  source: publisher
  sourceOnDemand: no
  maxReaders: 0
  overridePublisher: yes
  record: no  # Disable recording

paths:
  # ✅ MATCH ALL LIVE STREAMS
  ~^live/.*$:
    source: publisher
    sourceOnDemand: no
    record: no

  # ✅ MATCH PLAYBACK STREAMS
  ~^playback/.*$:
    source: publisher
    sourceOnDemand: no
    record: no


  # Catch-all for anything else
  all:
    source: publisher


###############################################
# ✅ RTSP (REQUIRED FOR JC261 PLAYBACK)
###############################################

rtsp: yes
rtspAddress: :8554

###############################################
# ✅ DISABLED PROTOCOLS (NOT NEEDED)
###############################################

srt: no